function checkCity(a) {
    var b;
    return $.ajax({
        type: "POST",
        async: !1,
        url: ctx + "/jobs/checkCity.json",
        data: {
            city: a
        }
    }).done(function(a) {
        b = a.success
    }),
    b
}
function getStrLen(a) {
    var c, d, b = 0;
    for (c = 0; c < a.length; c++) d = a.charCodeAt(c),
    b += isDbcCase(d) ? 1 : 2;
    return b
}
function isDbcCase(a) {
    return a >= 32 && 127 >= a ? !0 : a >= 65377 && 65439 >= a ? !0 : !1
}
$(function() {
    function a() {
        var a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u;
        $("#jobForm").valid() && 
                ($("#department").val() == $("#department").attr("placeholder") 
                  && $("#department").val(""), 
                  ("" == $("#salaryMin").val() || $("#salaryMin").val() == $("#salaryMin").attr("placeholder"))
                  && $("#salaryMin").val(""),
                  ("" == $("#salaryMax").val() || $("#salaryMax").val() == $("#salaryMax").attr("placeholder")) 
                  && $("#salaryMax").val(""), 
                  $("#positionAddress").val() == $("#positionAddress").attr("placeholder") 
                  && $("#positionAddress").val(""), 
                  a = $("#positionType").val(),
                  b = $("#positionName").val(), 
                  c = $('#jobForm input[name="r_sex"]:checked').val(), 
                  d = $('#jobForm input[name="r_language"]:checked').val(), 
                  e = $('#jobForm input[name="r_iflogbook"]').val(), 
                  f = $("#salaryMin").val(), 
                  g = $("#salaryMax").val(), 
                  h = $("#r_suffer").val(), 
                  i = $("#r_edu").val(), 
                  j = $("#r_age").val(), 
                  k = $("#r_describe").val(), 
                  l = $("#positionAddress").val(), 
                  m = $("#lng").val(), 
                  n = $("#lat").val(), 
                  q = $('#jobForm input[name="id"]').val(), 
                  r = $('#jobForm input[name="companyId"]').val(), 
                  s = $("#resubmitToken").val(), 
                  t = $("#g_type").val(),
                  u = $("#r_time").val(),
    $.ajax({
            url: ctx + "/corpPosition/savePosition.json",
            type: "POST",
            data: {
                positionType: a,
                positionName: b,
                r_sex: c,
                r_language: d,
                r_iflogbook: e,
                salaryMin: f,
                salaryMax: g,
                r_suffer: h,
                r_edu: i,
                r_age: j,
                r_describe: k,
                positionAddress: l,
                positionLng: m,
                positionLat: n,
                id: q,
                companyId: r,
                resubmitToken: s,
                g_type: t,
                r_time: u
            },
            dataType: "json"
        }).done(function(a) {
            $("#resubmitToken").val(a.resubmitToken),
            a.success ? window.location.href = ctx + a.content: "" != a.content && null != a.content ? window.location.href = ctx + a.content: $("#beError").html(a.msg).show()
        }))
    }
    $("#telForm").validate({
        rules: {
            tel: {
                required: !0,
                isTel: !0
            }
        },
        messages: {
            tel: {
                required: "请输入你的手机号码或座机号码",
                isTel: "请输入正确的手机号或座机号，座机格式如010-62555255或010-6255255-分机号，多个电话用英文逗号隔开"
            }
        },
        submitHandler: function(a) {
            var b = $('input[type="text"]', a).val();
            $(a).find(":submit").attr("disabled", !0),
            $.ajax({
                type: "POST",
                data: {
                    tel: b
                },
                url: ctx + "/user/addTel.json"
            }).done(function(b) {
                b.success ? $.colorbox.close() : $("#telError").text(b.msg).show(),
                $(a).find(":submit").attr("disabled", !1)
            })
        }
    }),
    $('#telTip input[type="text"]').focus(function() {
        $("#telError").hide()
    }),
    $(".profile_radio li input").click(function() {
        $(this).parent("li").siblings("li").removeClass("current"),
        $(this).parent("li").addClass("current"),
        $("#jobForm").validate().element($(this))
    }),
    $("#salaryMin").focus(function() {
        "" == $.trim($(this).val()) && $(this).prev().text("最低月薪").css({
            color: "#dddee0"
        })
    }).blur(function() {
        "" == $.trim($(this).val()) && $(this).prev().text("最低月薪").css({
            color: "#777"
        })
    }).keyup(function() {
        $(this).prev().text("")
    }),
    $("#salaryMax").focus(function() {
        "" == $.trim($(this).val()) && $(this).prev().text("最高月薪").css({
            color: "#dddee0"
        })
    }).blur(function() {
        "" == $.trim($(this).val()) && $(this).prev().text("最高月薪").css({
            color: "#777"
        })
    }).keyup(function() {
        $(this).prev().text("")
    }),
    $(document).click(function() {
        $("#box_job").hide(),
        $(".boxUpDown").hide(),
        $(".selectr").removeClass("selectrFocus")
    }),
    $("#box_job").bind("click",
    function(a) {
        a.stopPropagation()
    }),
    $("#box_job").on("mouseenter", ".job_main li",
    function() {
        $(this).children("ul").show();
        var a = "";
        $("#box_job .job_main").each(function() {
            $(this).children("li").each(function() {
                a = $("#box_job").height() - ($(this).offset().top - $(this).parents("#box_job").offset().top + 32),
                a < $(this).children(".job_sub").height() && (navigator.userAgent.indexOf("MSIE") > 0 && "7." == navigator.appVersion.match(/7./i) ? $(this).children(".job_sub").css({
                    marginTop: "-30" - $(this).children(".job_sub").height() + "px"
                }) : $(this).children(".job_sub").css({
                    marginTop: "-44" - $(this).children(".job_sub").height() + "px"
                }))
            })
        })
    }),
    $("#box_job").on("mouseleave", ".job_main li",
    function() {
        $(this).children("ul").hide()
    }),
    $("#select_category").bind("click",
    function(a) {
        a.stopPropagation(),
        $(".boxUpDown").hide(),
        $(".selectr").removeClass("selectrFocus"),
        $(this).addClass("selectrFocus"),
        $("#box_job").show()
    }),
    $("#box_job").on("click", ".job_sub li",
    function(a) {
        var b, c;
        a.stopPropagation(),
        b = $(this).parent("ul.job_sub").siblings("span").text(),
        c = $(this).text(),
        $("#select_category").css("color", "#333").val(b).removeClass("selectrFocus"),
        $("#positionType").val(b),
        $("#positionName").val(c),
        $(this).parents(".job_sub").hide(),
        $("#box_job").hide(),
        $("#jobForm").validate().element("#positionType"),
        $("#jobForm").validate().element("#positionName")
    }),
    $("#box_job").on("click", "ul.job_main > li",
    function(a) {
        a.stopPropagation();
        var b = $(this).children("span").text();
        $("#select_category").css("color", "#333").val(b).removeClass("selectrFocus"),
        $("#positionType").val(b),
        $("#positionName").val(""),
        $("#box_job").hide(),
        placeholderFn(),
        $("#jobForm").validate().element("#positionType")
    }),
    $("#box_job .job_main").each(function() {
        $(this).children("li").each(function(a) {
            1 == a % 3 ? $(this).children(".job_sub").css({
                marginLeft: "-160px"
            }) : 2 == a % 3 && $(this).children(".job_sub").css({
                marginLeft: "-310px"
            })
        })
    }),

    $("#select_suffer").bind("click",
    function(a) {
        a.stopPropagation(),
        $(".selectr").removeClass("selectrFocus"),
        $("#box_job").hide(),
        $(".boxUpDown").hide(),
        $(this).addClass("selectrFocus"),
        $(this).siblings(".boxUpDown").show()
    }),
    $("#box_suffer").on("click", "ul li",
    function(a) {
        a.stopPropagation();
        var b = $.trim($(this).text());
        $(this).parents("#box_suffer").hide().siblings("#select_suffer").val(b).css("color", "#333").removeClass("selectrFocus"),
        $(this).parents("#box_suffer").hide().siblings("#r_suffer").val(b),
        $("#jobForm").validate().element($("#r_suffer"))
    }),

    $("#select_edu").bind("click",
    function(a) {
        a.stopPropagation(),
        $(".selectr").removeClass("selectrFocus"),
        $("#box_job").hide(),
        $(".boxUpDown").hide(),
        $(this).addClass("selectrFocus"),
        $(this).siblings(".boxUpDown").show()
    }),
    $("#box_edu").on("click", "ul li",
    function(a) {
        a.stopPropagation();
        var b = $.trim($(this).text());
        $(this).parents("#box_edu").hide().siblings("#select_edu").val(b).css("color", "#333").removeClass("selectrFocus"),
        $(this).parents("#box_edu").hide().siblings("#r_edu").val(b),
        $("#jobForm").validate().element($("#r_edu"))
    }),

    $("#select_age").bind("click",
    function(a) {
        a.stopPropagation(),
        $(".selectr").removeClass("selectrFocus"),
        $("#box_job").hide(),
        $(".boxUpDown").hide(),
        $(this).addClass("selectrFocus"),
        $(this).siblings(".boxUpDown").show()
    }),
    $("#box_age").on("click", "ul li",
    function(a) {
        a.stopPropagation();
        var b = $.trim($(this).text());
        $(this).parents("#box_age").hide().siblings("#select_age").val(b).css("color", "#333").removeClass("selectrFocus"),
        $(this).parents("#box_age").hide().siblings("#r_age").val(b),
        $("#jobForm").validate().element($("#r_age"))
    }),

    $("#select_type").bind("click",
    function(a) {
        a.stopPropagation(),
        $(".selectr").removeClass("selectrFocus"),
        $("#box_job").hide(),
        $(".boxUpDown").hide(),
        $(this).addClass("selectrFocus"),
        $(this).siblings(".boxUpDown").show()
    }),
    $("#box_type").on("click", "ul li",
    function(a) {
        a.stopPropagation();
        var b = $.trim($(this).text());
        $(this).parents("#box_type").hide().siblings("#select_type").val(b).css("color", "#333").removeClass("selectrFocus"),
        $(this).parents("#box_type").hide().siblings("#g_type").val(b),
        $("#jobForm").validate().element($("#g_type"))
    }),

    $("#select_time").bind("click",
    function(a) {
        a.stopPropagation(),
        $(".selectr").removeClass("selectrFocus"),
        $("#box_job").hide(),
        $(".boxUpDown").hide(),
        $(this).addClass("selectrFocus"),
        $(this).siblings(".boxUpDown").show()
    }),
    $("#box_time").on("click", "ul li",
    function(a) {
        a.stopPropagation();
        var b = $.trim($(this).text());
        $(this).parents("#box_time").hide().siblings("#select_time").val(b).css("color", "#333").removeClass("selectrFocus"),
        $(this).parents("#box_time").hide().siblings("#r_time").val(b),
        $("#jobForm").validate().element($("#r_time"))
    }),

    $("#jobForm").submit(function() {
        tinyMCE.triggerSave(!0)
    }).validate({
        groups: {
            salary: "salaryMin salaryMax"
        },
        onkeyup: !1,
        focusCleanup: !0,
        rules: {
            positionName: {
                required: !0,
                specialchar: !0,
                rangelength: [1, 40]
            },
            positionType: {
                required: !0
            },
            r_sex: {
                required: !0
            },
            r_language: {
                required: !0
            },
            r_iflogbook: {
                required: !0
            },
            salaryMin: {
                required: function() {
                    return ! ("" != $("#salaryMin").val() && $("#salaryMin").val() != $("#salaryMin").attr("placeholder") || "" != $("#salaryMax").val() && $("#salaryMax").val() != $("#salaryMax").attr("placeholder"))
                },
                digits: !0,
                range: [1, 100],
                salaryRange: !0,
                Dvalue: !0
            },
            salaryMax: {
                required: function() {
                    return ! ("" != $("#salaryMin").val() && $("#salaryMin").val() != $("#salaryMin").attr("placeholder") || "" != $("#salaryMax").val() && $("#salaryMax").val() != $("#salaryMax").attr("placeholder"))
                },
                digits: !0,
                range: [1, 100],
                salaryRange: !0,
                Dvalue: !0
            },
            r_suffer: {
                required: !0
            },
            r_edu: {
                required: !0
            },
            r_age: {
                required: !0,
            },
            r_describe: {
                required: !0,
            },
            positionAddress: {
                required: !0,
                maxlength: 150,
            },
        },
        messages: {
            positionName: {
                required: "请输入职位名称，如：产品经理",
                specialchar: "请输入有效的职位名称",
                rangelength: "请输入1-40字的职位名称"
            },
            positionType: {
                required: "请选择职位类别"
            },
            r_sex: {
                required: "请选择性别"
            },
            r_language: {
                required: "请选择语言"
            },
            r_iflogbook: {
                required: "请选择是否全日制",
            },
            salaryMin: {
                required: "请输入月薪范围，如：4",
                digits: "请输入有效的月薪范围，如：4",
                range: "请输入有效的月薪范围，1k-100k",
                salaryRange: "最高月薪不能大于最低月薪的2倍",
                Dvalue: "最高月薪需大于最低月薪"
            },
            salaryMax: {
                required: "请输入月薪范围，如：4",
                digits: "请输入有效的月薪范围，如：4",
                range: "请输入有效的月薪范围，1k-100k",
                salaryRange: "最高月薪不能大于最低月薪的2倍",
                Dvalue: "最高月薪需大于最低月薪"
            },
            r_suffer: {
                required: "请选择工作年限"
            },
            r_edu: {
                required: "请选择学历要求"
            },
            r_age: {
                required: "请选择年龄"
            },
            r_describe: {
                required: "请输入岗位职责、任职要求等，建议尽量使用短句并分条列出",
            },
            positionAddress: {
                required: "请输入工作地点",
                maxlength: "请输入150字以内的工作地点"
            },
        },
        errorPlacement: function(a, b) {
            "hidden" == b.attr("type") ? a.appendTo($(b).parent()) : "radio" == b.attr("type") ? a.insertAfter($(b).parents("ul.profile_radio")) : "salaryMin" == b.attr("name") || "salaryMax" == b.attr("name") ? a.insertAfter($(b).parents(".salary_range")) : b.is("textarea") ? a.appendTo($(b).parent()) : a.insertAfter($(b))
        },
        invalidHandler: function(a, b) {
            if (b.numberOfInvalids()) {
                var c = $(b.errorList[0].element).offset().top;
                "positionType" == b.errorList[0].element.name ? c = 150 : "workYear" == b.errorList[0].element.name ? c = 650 : "education" == b.errorList[0].element.name && (c = 700),
                $("html, body").animate({
                    scrollTop: c
                },
                400)
            }
        }
    }),
    jQuery.validator.addMethod("specialchar",
    function(a, b) {
        return this.optional(b) || checkCity(a)
    },
    "请输入有效的公司所在城市，如：北京"),

    $("#jobPreview").click(function() {
        $("#jobForm").attr({
            action: "postAdd",
        }).submit()
    }),
    $("#formSubmit").click(function() {
        a()
    })
});